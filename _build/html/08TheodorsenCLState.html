
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Identification of the Theodorsen model by treating \(C_L\) as a state &#8212; System Identification for Unsteady Airfoils</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Summary" href="09Summary.html" />
    <link rel="prev" title="Identification of a dynamical system for the Wagner function" href="08WagnerSINDy.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">System Identification for Unsteady Airfoils</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    System Identification for unsteady Airfoils
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="00Abstract.html">
   Abstract
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01Introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Classical unsteady lift models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="02TheodorsenModel.html">
   The Theodorsen Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="025StateSpaceTheodorsen.html">
   Implementation of the linearised Theodorsen model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03WagnerFunction.html">
   The Wagner function
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  System identification
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="04Identification.html">
   System identification algorithms
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05IdentificationForUnsteadyLift.html">
   System identification for unsteady lift
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06PolynomialChaos.html">
   Orthogonal basis and Polynomial Chaos
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07PC_code.html">
   Implementation of the orthogonal polynomial basis
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Results
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="08WagnerSINDy.html">
   Identification of a dynamical system for the Wagner function
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Identification of the Theodorsen model by treating
   <span class="math notranslate nohighlight">
    \(C_L\)
   </span>
   as a state
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Summary
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="09Summary.html">
   Summary
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bibliography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/08TheodorsenCLState.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F08TheodorsenCLState.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/08TheodorsenCLState.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#derivation-of-the-extended-theodorsen-model-with-c-l-as-a-state">
   Derivation of the extended Theodorsen model with
   <span class="math notranslate nohighlight">
    \(C_L\)
   </span>
   as a state
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identification-of-the-extended-theodorsen-model-with-c-l-as-a-state">
   Identification of the extended Theodorsen model with
   <span class="math notranslate nohighlight">
    \(C_L\)
   </span>
   as a state
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training-data">
     Training data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training">
     Training
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validation">
     Validation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identification-of-an-approximated-theodorsen-model-without-the-tilde-x-states">
   Identification of an approximated Theodorsen model without the
   <span class="math notranslate nohighlight">
    \(\tilde{x}\)
   </span>
   states
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Training data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Training
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Validation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusions">
   Conclusions
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Identification of the Theodorsen model by treating C_L as a state</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#derivation-of-the-extended-theodorsen-model-with-c-l-as-a-state">
   Derivation of the extended Theodorsen model with
   <span class="math notranslate nohighlight">
    \(C_L\)
   </span>
   as a state
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identification-of-the-extended-theodorsen-model-with-c-l-as-a-state">
   Identification of the extended Theodorsen model with
   <span class="math notranslate nohighlight">
    \(C_L\)
   </span>
   as a state
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training-data">
     Training data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training">
     Training
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validation">
     Validation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identification-of-an-approximated-theodorsen-model-without-the-tilde-x-states">
   Identification of an approximated Theodorsen model without the
   <span class="math notranslate nohighlight">
    \(\tilde{x}\)
   </span>
   states
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Training data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Training
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Validation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusions">
   Conclusions
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="section-results-theodorsen">
<span id="identification-of-the-theodorsen-model-by-treating-c-l-as-a-state"></span><h1>Identification of the Theodorsen model by treating <span class="math notranslate nohighlight">\(C_L\)</span> as a state<a class="headerlink" href="#section-results-theodorsen" title="Permalink to this headline">#</a></h1>
<p>The goal of the following 2-step numerical experiment was to replicate the behaviour of the Theodorsen model by using SINDy on trajectory datasets comprising of the inputs <span class="math notranslate nohighlight">\(u = [\ddot \alpha, \ddot h]\)</span> and a state vector expanded to include the lift coefficient <span class="math notranslate nohighlight">\(C_L\)</span>. The goal was to overcome the fact that SINDy estimates the full-state output model of the system (i.e. the <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> matrices in the case of an LTI system), without regarding how the states contribute to the final output (i.e. not estimating the <span class="math notranslate nohighlight">\(C\)</span> and <span class="math notranslate nohighlight">\(D\)</span> matrices in case of an LTI system). This limitation is not fundamental, since having estimated the states, the <span class="math notranslate nohighlight">\(x \rightarrow y\)</span> relationship can be estimated by a second regression step, but simplyfying the process into one regression step was an interesting alternative.</p>
<section id="derivation-of-the-extended-theodorsen-model-with-c-l-as-a-state">
<h2>Derivation of the extended Theodorsen model with <span class="math notranslate nohighlight">\(C_L\)</span> as a state<a class="headerlink" href="#derivation-of-the-extended-theodorsen-model-with-c-l-as-a-state" title="Permalink to this headline">#</a></h2>
<p>Given an LTI approximation to the Theodorsen model of the form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{x} = Ax + Bu = A \begin{bmatrix} \tilde{x}\\ \dot{h}\\ \alpha\\ \dot{\alpha} \end{bmatrix} + B \begin{bmatrix}\ddot{h}\\ \ddot{\alpha}\end{bmatrix}\end{split}\]</div>
<p>the derivative of the lift coefficient can be expressed as:</p>
<div class="math notranslate nohighlight">
\[\dot{C}_L = \frac{d}{dt}(Cx + Du) = C\dot{x} + D\dot{u} = CAx + CBu + D\dot{u}\]</div>
<p>The equation above has one undesireable property — the differentiation of <span class="math notranslate nohighlight">\(u\)</span>. This problem can be mitigated by defining a lift coefficient with the influence of the <span class="math notranslate nohighlight">\(D\)</span> matrix subtracted:</p>
<div class="math notranslate nohighlight">
\[C_L^x = C_L - Du\]</div>
<div class="math notranslate nohighlight">
\[\dot{C}_L^x = CAx + CBu\]</div>
<p>The above equation is a valid state-space model. The separation of the <span class="math notranslate nohighlight">\(Du\)</span> term is not a big issue, given that it can be easily estimated independently <span id="id1">[<a class="reference internal" href="bibliography.html#id18" title="Steven L. Brunton, Clarence W. Rowley, and David R. Williams. Reduced-order unsteady aerodynamic models at low Reynolds numbers. Journal of Fluid Mechanics, 724:203–233, 2013. doi:10.1017/jfm.2013.163.">BRW13</a>]</span>.</p>
<p>The final state-space representation of the model is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{\hat{x}} = \frac{d}{dt} \begin{bmatrix}x\\ C_L^x\end{bmatrix} = \begin{bmatrix}A &amp; 0\\ CA &amp; 0\end{bmatrix} \hat{x} + \begin{bmatrix}B \\ CB \end{bmatrix} u\end{split}\]</div>
</section>
<section id="identification-of-the-extended-theodorsen-model-with-c-l-as-a-state">
<h2>Identification of the extended Theodorsen model with <span class="math notranslate nohighlight">\(C_L\)</span> as a state<a class="headerlink" href="#identification-of-the-extended-theodorsen-model-with-c-l-as-a-state" title="Permalink to this headline">#</a></h2>
<p>The following code shows that this model can be identified (with some caveats) using SINDy. Training is performed on 5 selected datasets, while validation on yet another one.</p>
<section id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">control</span>
<span class="kn">import</span> <span class="nn">Theodorsen_control</span> <span class="k">as</span> <span class="nn">theodorsen</span> <span class="c1"># our library for using Theodorsen model LTI approximations</span>
<span class="kn">import</span> <span class="nn">pysindy</span>
<span class="kn">import</span> <span class="nn">signals</span> <span class="c1"># our library with identification signals</span>
<span class="kn">import</span> <span class="nn">sklearn</span> <span class="k">as</span> <span class="nn">sk</span>
<span class="kn">import</span> <span class="nn">scipy.fftpack</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="c1">#seed for consistence; generated by np.random.randint(low=0, high=2, size=31)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">1345098234</span><span class="p">)</span> <span class="c1"># second seed for constistence</span>
</pre></div>
</div>
</div>
</div>
<p>The parameters of the airfoil:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># pitch axis wrt to 1/2-chord</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">1.</span>  <span class="c1"># half-chord length of the airfoil</span>
<span class="c1"># default values of C_1 and C_2 used</span>
<span class="n">airfoil</span> <span class="o">=</span> <span class="n">theodorsen</span><span class="o">.</span><span class="n">AirfoilGeometry</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The 4-state approximation of the Theodorsen fuction from <span id="id2">[<a class="reference internal" href="bibliography.html#id19" title="Steven L Brunton and Clarence W Rowley. Empirical state-space representations for theodorsen's lift model. Journal of Fluids and Structures, 38:174–186, 2013.">BR13</a>]</span> is used in the full Thedorsen state-space LTI approximation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the balanced truncation Theodorsen function approximation</span>
<span class="n">theodorsen_function_sys</span> <span class="o">=</span> <span class="n">theodorsen</span><span class="o">.</span><span class="n">theodorsen_function_balanced_truncation_ss</span><span class="p">()</span>

<span class="c1"># state-space system with both α&quot; and h&quot; as inputs</span>
<span class="n">theodorsen_full_sys</span> <span class="o">=</span> <span class="n">theodorsen</span><span class="o">.</span><span class="n">unsteady_lift_ss</span><span class="p">(</span>
    <span class="n">airfoil</span><span class="p">,</span> <span class="n">theodorsen_function_sys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>A class for processing trajectory datasets is implemented:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TrajectoryDatasets</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Collection of unsteady lift time series (with states, inputs etc).&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theodorsen_sys</span><span class="p">,</span> <span class="n">observe_states_from</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C_L</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theodorsen_sys</span> <span class="o">=</span> <span class="n">theodorsen_sys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observe_states_from</span> <span class="o">=</span> <span class="n">observe_states_from</span>

    <span class="k">def</span> <span class="nf">add_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">states_from</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create a dataset with given time and inputs.&#39;&#39;&#39;</span>
        <span class="n">u_MISO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">u_h</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">u_alpha</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="c1"># time response</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">forced_response</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theodorsen_sys</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">u_MISO</span><span class="p">)</span>

        <span class="c1"># time response postprocessing</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">theodorsen</span><span class="o">.</span><span class="n">TheodorsenTimeResponse</span><span class="p">(</span>
            <span class="n">output</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">theodorsen_sys</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">io_plot</span><span class="p">()</span>

        <span class="c1"># new results-</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_MISO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C_L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">observe_states_from</span><span class="p">:,</span> <span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">C_L_without_Du</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Compute C_L(t)-Du(t).&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Du</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theodorsen_sys</span><span class="o">.</span><span class="n">D</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>
            <span class="n">C_L_Du</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_L</span><span class="p">[</span><span class="n">num</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">Du</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">C_L_Du</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">C_L</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C_L</span><span class="p">):</span>
                <span class="n">Du</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theodorsen_sys</span><span class="o">.</span><span class="n">D</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">C_L_Du</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C_L</span> <span class="o">-</span> <span class="n">Du</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">C_L_Du</span>

    <span class="k">def</span> <span class="nf">x_with_C_L_Du</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Extend the state vector by adding C_L-Du to the bottom.&#39;&#39;&#39;</span>
        <span class="n">x_extended</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">):</span>
            <span class="n">x_extended</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_L_without_Du</span><span class="p">(</span><span class="n">i</span><span class="p">))))</span>
        <span class="k">return</span> <span class="n">x_extended</span>
</pre></div>
</div>
</div>
</div>
<p>The class is instantiated:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasets</span> <span class="o">=</span> <span class="n">TrajectoryDatasets</span><span class="p">(</span><span class="n">theodorsen_full_sys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="training-data">
<h3>Training data<a class="headerlink" href="#training-data" title="Permalink to this headline">#</a></h3>
<p>5 carefully chosen trajectories with various combinations of input signals are generated as the training dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_end</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># length of cases (except for one)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1"># time array</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CASE 1</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">linear_chirp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">omega_init</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">omega_end</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">prbs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">datasets</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_13_0.png" src="_images/08TheodorsenCLState_13_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CASE 2</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">square_wave</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">white_noise_averaged</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">averaging_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">datasets</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_14_0.png" src="_images/08TheodorsenCLState_14_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CASE 3</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">white_noise_averaged</span><span class="p">(</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">averaging_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">square_wave</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">3.2</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span>
<span class="n">datasets</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_15_0.png" src="_images/08TheodorsenCLState_15_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CASE 4</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">prbs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">linear_chirp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">omega_init</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">omega_end</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">datasets</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_16_0.png" src="_images/08TheodorsenCLState_16_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CASE 5</span>
<span class="c1"># this case uses a longer time period to capture more low-frequency dynamics of the chirp</span>
<span class="n">t_long</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">linear_chirp</span><span class="p">(</span>
    <span class="n">t_long</span><span class="p">,</span> <span class="n">omega_init</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">omega_end</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.006</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">square_wave</span><span class="p">(</span><span class="n">t_long</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">datasets</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">t_long</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_17_0.png" src="_images/08TheodorsenCLState_17_0.png" />
</div>
</div>
</section>
<section id="training">
<h3>Training<a class="headerlink" href="#training" title="Permalink to this headline">#</a></h3>
<p>The SINDy identification is set up and trained on the dataset shown above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>

<span class="k">def</span> <span class="nf">transpose_all</span><span class="p">(</span><span class="n">list_of_arrays</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Transpose all arrays in a list&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">list_of_arrays</span><span class="p">]</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">pysindy</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">stlsq</span><span class="o">.</span><span class="n">STLSQ</span><span class="p">(</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pysindy</span><span class="o">.</span><span class="n">SINDy</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                      <span class="n">feature_library</span><span class="o">=</span><span class="n">pysindy</span><span class="o">.</span><span class="n">PolynomialLibrary</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># training</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transpose_all</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">x_with_C_L_Du</span><span class="p">()),</span>
          <span class="n">t</span><span class="o">=</span><span class="n">datasets</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">transpose_all</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">u</span><span class="p">),</span> <span class="n">multiple_trajectories</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Identified model:&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Identified model:
(x0)&#39; = -0.871 x0 + -0.116 x1 + 13.064 x4 + 13.058 x5 + 6.882 x6 + -2.180 x7
(x1)&#39; = 1.000 x0
(x2)&#39; = 1.000 x1
(x3)&#39; = 1.000 x2
(x4)&#39; = -0.012 x0 + 0.202 x4 + 0.198 x5 + 0.069 x6 + -0.036 x7 + 0.930 u0
(x5)&#39; = 1.000 x6
(x6)&#39; = 0.945 u1
(x7)&#39; = -0.063 x0 + 2.305 x4 + 2.250 x5 + 4.301 x6 + -0.396 x7 + 2.945 u0 + 2.961 u1
</pre></div>
</div>
</div>
</div>
</section>
<section id="validation">
<h3>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">#</a></h3>
<p>The model is validated on another dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># validation scenario</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">prbs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span> <span class="c1"># signals.square_wave(t, T=3, phase=1.5, amplitude=0.01)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">white_noise_averaged</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">averaging_radius</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">u_MISO_validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">u_h</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">u_alpha</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

<span class="c1"># time response</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">forced_response</span><span class="p">(</span>
    <span class="n">theodorsen_full_sys</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">u_MISO_validation</span><span class="p">)</span>

<span class="c1"># time response postprocessing</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">theodorsen</span><span class="o">.</span><span class="n">TheodorsenTimeResponse</span><span class="p">(</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">=</span><span class="n">theodorsen_full_sys</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">io_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_22_0.png" src="_images/08TheodorsenCLState_22_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># simulating the output of the identified model</span>
<span class="n">x_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="p">)),</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u_MISO_validation</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The results are plotted for a visual comparison:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot of the Theodorsen function states</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;States of the Theodorson function approximating model&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">x_theodorsen</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
             <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$x_</span><span class="si">{}</span><span class="s1">$ model&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_model</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$x_</span><span class="si">{}</span><span class="s1">$ SINDy&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$x_</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [-]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_25_0.png" src="_images/08TheodorsenCLState_25_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot of the &quot;physical&quot; states</span>
<span class="c1"># h&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Physical states of the system&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">h_dot</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_model</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\dot</span><span class="si">{h}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># alpha</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">alpha</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_model</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\alpha$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># alpha&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">alpha_dot</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_model</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [-]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\dot{\alpha}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_26_0.png" src="_images/08TheodorsenCLState_26_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot of C_L</span>
<span class="c1"># C_L_SINDy computed using the true C and D, because this usecase of SINDy does not estimate them</span>
<span class="n">Du</span> <span class="o">=</span> <span class="n">theodorsen_full_sys</span><span class="o">.</span><span class="n">D</span> <span class="o">@</span> <span class="n">data</span><span class="o">.</span><span class="n">u</span>
<span class="n">C_L_SINDy</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x_model</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">Du</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_SINDy</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_SINDy</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;RMSE = </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$C_L$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_SINDy</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\Delta C_L$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">C_L_x_SINDy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x_model</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">Du</span> <span class="o">=</span> <span class="p">(</span><span class="n">theodorsen_full_sys</span><span class="o">.</span><span class="n">D</span> <span class="o">@</span> <span class="n">data</span><span class="o">.</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Du</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_x_SINDy</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$C_L - Du$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Du</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$Du$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [-]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_27_0.png" src="_images/08TheodorsenCLState_27_0.png" />
</div>
</div>
<p>It can be seen that all the states of the system are replicated correctly, and the validation <span class="math notranslate nohighlight">\(C_L\)</span> has a very small root mean square error (RMSE). This demonstrates that adding <span class="math notranslate nohighlight">\(C_L^x\)</span> as a state is a viable modification of the identification problem.</p>
</section>
</section>
<section id="identification-of-an-approximated-theodorsen-model-without-the-tilde-x-states">
<h2>Identification of an approximated Theodorsen model without the <span class="math notranslate nohighlight">\(\tilde{x}\)</span> states<a class="headerlink" href="#identification-of-an-approximated-theodorsen-model-without-the-tilde-x-states" title="Permalink to this headline">#</a></h2>
<p>While the above demonstration proved that <span class="math notranslate nohighlight">\(C_L\)</span> can be successfully treated as a state for identification, it was not practical in nature, because as of now we do not have access to the Theodorsen function states <span class="math notranslate nohighlight">\(\tilde{x}\)</span> from CFD data, nor can we assume that the low Reynolds number problems will use the same reduced flow state <span class="math notranslate nohighlight">\(\tilde{x}\)</span>. Because of this, a second experiment has been performed. The only difference with respect to the previous one is that the only states available to SINDy are:</p>
<div class="math notranslate nohighlight">
\[x' = [\dot{h}, \alpha, \dot{\alpha}, C_L]^T\]</div>
<p>The rationale is that the aforementioned states are always available, so it might be of interest to create a model that instead of the reduced flow states <span class="math notranslate nohighlight">\(\tilde{x}\)</span> utilises nonlinear relationships between the <span class="math notranslate nohighlight">\(x'\)</span> states.</p>
<p>The description of the identification process is less verbose, because it is identical to the previous one, aside from ignoring the <span class="math notranslate nohighlight">\(\tilde{x}\)</span> states.</p>
<section id="id3">
<h3>Setup<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasets</span> <span class="o">=</span> <span class="n">TrajectoryDatasets</span><span class="p">(</span><span class="n">theodorsen_full_sys</span><span class="p">,</span> <span class="n">observe_states_from</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h3>Training data<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CASE 1</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">linear_chirp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">omega_init</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">omega_end</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">prbs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">datasets</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># CASE 2</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">square_wave</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">white_noise_averaged</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">averaging_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">datasets</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># CASE 3</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">white_noise_averaged</span><span class="p">(</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">averaging_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">square_wave</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">3.2</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span>
<span class="n">datasets</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># CASE 4</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">prbs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">linear_chirp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">omega_init</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">omega_end</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">datasets</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># CASE 5</span>
<span class="n">u_alpha</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">linear_chirp</span><span class="p">(</span>
    <span class="n">t_long</span><span class="p">,</span> <span class="n">omega_init</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">omega_end</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.006</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">square_wave</span><span class="p">(</span><span class="n">t_long</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">datasets</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">t_long</span><span class="p">,</span> <span class="n">u_alpha</span><span class="p">,</span> <span class="n">u_h</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h3>Training<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<p>For additional insights, two models are trained: one using a polynomial base of order 1, while the second one — of order 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SYSTEM IDENTIFCATION</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">pysindy</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">stlsq</span><span class="o">.</span><span class="n">STLSQ</span><span class="p">(</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">model_1</span> <span class="o">=</span> <span class="n">pysindy</span><span class="o">.</span><span class="n">SINDy</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                      <span class="n">feature_library</span><span class="o">=</span><span class="n">pysindy</span><span class="o">.</span><span class="n">PolynomialLibrary</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">pysindy</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">stlsq</span><span class="o">.</span><span class="n">STLSQ</span><span class="p">(</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">model_2</span> <span class="o">=</span> <span class="n">pysindy</span><span class="o">.</span><span class="n">SINDy</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                      <span class="n">feature_library</span><span class="o">=</span><span class="n">pysindy</span><span class="o">.</span><span class="n">PolynomialLibrary</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># training</span>
<span class="n">model_1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transpose_all</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">x_with_C_L_Du</span><span class="p">()),</span>
          <span class="n">t</span><span class="o">=</span><span class="n">datasets</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">transpose_all</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">u</span><span class="p">),</span> <span class="n">multiple_trajectories</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Identified model (order 1):&#39;</span><span class="p">)</span>
<span class="n">model_1</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>

<span class="n">model_2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transpose_all</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">x_with_C_L_Du</span><span class="p">()),</span>
          <span class="n">t</span><span class="o">=</span><span class="n">datasets</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">transpose_all</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">u</span><span class="p">),</span> <span class="n">multiple_trajectories</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Identified model (order 2):&#39;</span><span class="p">)</span>
<span class="n">model_2</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Identified model (order 1):
(x0)&#39; = 0.047 x0 + 0.058 x1 + 0.022 x2 + -0.012 x3 + 0.947 u0
(x1)&#39; = 1.000 x2
(x2)&#39; = 0.945 u1
(x3)&#39; = 1.525 x0 + 1.555 x1 + 4.064 x2 + -0.277 x3 + 3.026 u0 + 2.957 u1
Identified model (order 2):
(x0)&#39; = 0.076 x0 + 0.096 x1 + 0.042 x2 + -0.019 x3 + 0.942 u0 + -4.727 x0^2 + -15.917 x0 x1 + -6.649 x0 x2 + 2.872 x0 x3 + 2.250 x0 u0 + -2.094 x0 u1 + -12.747 x1^2 + -9.058 x1 x2 + 4.673 x1 x3 + 3.245 x1 u0 + -2.604 x1 u1 + -2.106 x2^2 + 1.580 x2 x3 + 2.039 x2 u0 + -1.493 x2 u1 + -0.423 x3^2 + -0.651 x3 u0 + 0.546 x3 u1 + 0.536 u0^2 + 0.548 u0 u1 + 0.924 u1^2
(x1)&#39; = 1.000 x2 + 0.217 x0 x2 + 0.211 x1 x2 + 0.088 x2^2 + -0.049 x2 x3 + 0.011 x2 u1
(x2)&#39; = -0.052 x0 + -0.071 x1 + -0.015 x2 + 0.013 x3 + 0.931 u1 + -1.207 x0^2 + 0.101 x0 x1 + 2.937 x0 x2 + 0.312 x0 x3 + -1.105 x0 u0 + 2.562 x0 u1 + 2.340 x1^2 + 3.057 x1 x2 + -0.458 x1 x3 + -1.575 x1 u0 + 5.444 x1 u1 + 1.064 x2^2 + -0.549 x2 x3 + -1.286 x2 u0 + 2.357 x2 u1 + 0.362 x3 u0 + -0.968 x3 u1 + 0.682 u0^2 + 0.247 u0 u1 + 0.246 u1^2
(x3)&#39; = 1.669 x0 + 1.718 x1 + 4.171 x2 + -0.313 x3 + 2.988 u0 + 2.940 u1 + -7.765 x0^2 + -34.161 x0 x1 + -11.127 x0 x2 + 5.949 x0 x3 + 1.444 x0 u0 + 1.319 x0 u1 + -29.988 x1^2 + -18.717 x1 x2 + 10.793 x1 x3 + 4.866 x1 u0 + 7.769 x1 u1 + -0.468 x2^2 + 2.533 x2 x3 + 1.195 x2 u0 + 2.241 x2 u1 + -0.964 x3^2 + -0.629 x3 u0 + -1.332 x3 u1 + 7.980 u0^2 + 2.279 u0 u1 + -0.191 u1^2
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h3>Validation<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h3>
<p>The model is validated on another dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># time response</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">forced_response</span><span class="p">(</span>
    <span class="n">theodorsen_full_sys</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">u_MISO_validation</span><span class="p">)</span>

<span class="c1"># time response postprocessing</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">theodorsen</span><span class="o">.</span><span class="n">TheodorsenTimeResponse</span><span class="p">(</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">=</span><span class="n">theodorsen_full_sys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># simulating the output of the identified model</span>
<span class="n">x_model_1</span> <span class="o">=</span> <span class="n">model_1</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="p">)),</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u_MISO_validation</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The trajectory of the second degree nonlinear system is not generated here due to computational cost, but its results turned out to be completely equivalent. Note that even its 1st order terms are very similar. Due do this, the second degree model was not considered in the following parts.</p>
<p>The results are plotted for a visual comparison:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot of the &quot;physical&quot; states</span>
<span class="c1"># h&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Physical states of the system&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">h_dot</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_model_1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy ($x</span><span class="se">\&#39;</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\dot</span><span class="si">{h}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># alpha</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">alpha</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_model_1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy ($x</span><span class="se">\&#39;</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\alpha$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># alpha&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">alpha_dot</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_model_1</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy ($x</span><span class="se">\&#39;</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [-]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\dot{\alpha}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_40_0.png" src="_images/08TheodorsenCLState_40_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot of C_L</span>
<span class="c1"># C_L_SINDy computed using the true C and D, because this usecase of SINDy does not estimate them</span>
<span class="n">Du</span> <span class="o">=</span> <span class="n">theodorsen_full_sys</span><span class="o">.</span><span class="n">D</span> <span class="o">@</span> <span class="n">data</span><span class="o">.</span><span class="n">u</span>
<span class="n">C_L_SINDy_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x_model_1</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">Du</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">C_L_SINDy_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x_model_1</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">Du</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">rmse_1</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_SINDy_1</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">rmse_2</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_SINDy_2</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_SINDy_1</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy ($x</span><span class="se">\&#39;</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;RMSE = </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse_1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$C_L$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_SINDy_1</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\Delta C_L$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">C_L_x_SINDy_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x_model_1</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">C_L_x_SINDy_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x_model_1</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">Du</span> <span class="o">=</span> <span class="p">(</span><span class="n">theodorsen_full_sys</span><span class="o">.</span><span class="n">D</span> <span class="o">@</span> <span class="n">data</span><span class="o">.</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Du</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_x_SINDy_1</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy ($x</span><span class="se">\&#39;</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$C_L - Du$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Du</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$Du$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [-]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_41_0.png" src="_images/08TheodorsenCLState_41_0.png" />
</div>
</div>
<p>It can be seen that all the states of the system are replicated correctly, and the validation <span class="math notranslate nohighlight">\(C_L\)</span> still has a small root mean square error (RMSE), although about an order of magnitude larger than the previous case, where <span class="math notranslate nohighlight">\(\tilde{x}\)</span> was part of the training data. It is also important to note that the 1st and 2nd order models have almost equivalent performance, with the 1st order performing even slightly better in predicting <span class="math notranslate nohighlight">\(\alpha\)</span>. This suggest that the attenuating influence of the Thedorsen function states <span class="math notranslate nohighlight">\(\tilde{x}\)</span> can’t be expressed as quadratic nonlinearities of the <span class="math notranslate nohighlight">\(x'\)</span> states (or at least that such relationships are not straightforward to identify), and that the linear dynamics of <span class="math notranslate nohighlight">\(x'\)</span> are the dominating effect in the data. The second statement might raise doubts whether the wake effects are captured by the identified model at all. This is verified by comparing the data with a simplified Theodorsen model that simplifies the attenuating effects of the wake into a constang gain and no phase shift, i.e. assuming that the Theodorsen function <span class="math notranslate nohighlight">\(C(k)\)</span> is constant for all <span class="math notranslate nohighlight">\(k\)</span>. The 3 values of interest: <span class="math notranslate nohighlight">\(C(k)=1\)</span> (the low-frequency limit of the function), <span class="math notranslate nohighlight">\(C(k) = 0.25\)</span> (the high-frequency limit) and <span class="math notranslate nohighlight">\(C(k) = 0.7\)</span> (the intermediate value, corresponding to frequencies of the order of <span class="math notranslate nohighlight">\(0.5 [rad/s]\)</span>):</p>
<div class="math notranslate nohighlight">
\[C_L^{(C(k)=1} = C_1 (\ddot{h} + \dot{\alpha} + a\ddot{\alpha}) + C_2(\alpha + \dot{h} + \dot{\alpha}(1/2-a))C(k)\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C_L_AMQS_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">airfoil</span><span class="o">.</span><span class="n">C_1</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">h_ddot</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">alpha_dot</span> <span class="o">-</span> <span class="n">airfoil</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">alpha_ddot</span><span class="p">)</span> <span class="o">+</span>
           <span class="n">airfoil</span><span class="o">.</span><span class="n">C_2</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">h_dot</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">alpha_dot</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">airfoil</span><span class="o">.</span><span class="n">a</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
<span class="n">C_L_AMQS_07</span> <span class="o">=</span> <span class="p">(</span><span class="n">airfoil</span><span class="o">.</span><span class="n">C_1</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">h_ddot</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">alpha_dot</span> <span class="o">-</span> <span class="n">airfoil</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">alpha_ddot</span><span class="p">)</span> <span class="o">+</span>
           <span class="mf">0.7</span><span class="o">*</span><span class="n">airfoil</span><span class="o">.</span><span class="n">C_2</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">h_dot</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">alpha_dot</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">airfoil</span><span class="o">.</span><span class="n">a</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
<span class="n">C_L_AMQS_025</span> <span class="o">=</span> <span class="p">(</span><span class="n">airfoil</span><span class="o">.</span><span class="n">C_1</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">h_ddot</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">alpha_dot</span> <span class="o">-</span> <span class="n">airfoil</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">alpha_ddot</span><span class="p">)</span> <span class="o">+</span>
           <span class="mf">0.25</span><span class="o">*</span><span class="n">airfoil</span><span class="o">.</span><span class="n">C_2</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">h_dot</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">alpha_dot</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">airfoil</span><span class="o">.</span><span class="n">a</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>

<span class="n">C_L_AMQS_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">C_L_AMQS_1</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
<span class="n">C_L_AMQS_07</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">C_L_AMQS_07</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
<span class="n">C_L_AMQS_025</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">C_L_AMQS_025</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>

<span class="n">rmse_1</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">,</span> <span class="n">C_L_AMQS_1</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">rmse_2</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">,</span> <span class="n">C_L_AMQS_07</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">rmse_3</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">,</span> <span class="n">C_L_AMQS_025</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_AMQS_1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;c-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$C_L$ if $C(k)=1$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_AMQS_025</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r-.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$C_L$ if $C(k)=0.25$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_AMQS_07</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;y--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$C_L$ if $C(k)=0.7$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;RMSE 1 = </span><span class="si">{:.2e}</span><span class="s1">; RMSE 0.5 = </span><span class="si">{:.2e}</span><span class="s1">; RMSE 0.25 = </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse_1</span><span class="p">,</span> <span class="n">rmse_2</span><span class="p">,</span> <span class="n">rmse_3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$C_L$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [-]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_43_0.png" src="_images/08TheodorsenCLState_43_0.png" />
</div>
</div>
<p>A comparison is made between the error of the simplified models with various values of <span class="math notranslate nohighlight">\(C(k)\)</span>, the model identified using <span class="math notranslate nohighlight">\(x'\)</span> and the model identified previously using ‘x’:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_AMQS_1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;c-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$C_L$ if $C(k)=1$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_AMQS_025</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r-.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$C_L$ if $C(k)=0.25$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_AMQS_07</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;y-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$C_L$ if $C(k)=0.7$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_SINDy_1</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy ($x</span><span class="se">\&#39;</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_L_SINDy</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">C_L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SINDy (x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\Delta C_L$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t [-]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08TheodorsenCLState_45_0.png" src="_images/08TheodorsenCLState_45_0.png" />
</div>
</div>
<p>It can be seen that none of the limit values of <span class="math notranslate nohighlight">\(C(k)\)</span> provides an error as small as the identified model. The intermediate value <span class="math notranslate nohighlight">\(C(k)=0.8\)</span> achieves a similar RMSE. However, the identified model’s error evolves in a much more predictable way, most likely due to the integrative properties of the model accumulating error over time, while the simplified model’s error is more erratic. This suggests that the identified model actually does capture some of the effects of the Theodorsen function, and, by extension, of the quasi-steady lift attenuation by the wake behind the airfoil. This is possible, because the identified model has the form:</p>
<div class="math notranslate nohighlight">
\[\frac{d}{dt} C_L^x = a_1 \dot{h} + a_2 \alpha + a_3 \dot{\alpha} + a_4 C_L + b_1 \ddot{h} + b_2 \ddot{\alpha} \]</div>
<p>where <span class="math notranslate nohighlight">\(a_i\)</span> are the significant identified coefficients of the last row of the <span class="math notranslate nohighlight">\(A'\)</span> matrix, while the <span class="math notranslate nohighlight">\(b_i\)</span> — of the <span class="math notranslate nohighlight">\(B'\)</span> matrix. The simplified model, on the other hand, after subtracting the <span class="math notranslate nohighlight">\(Du\)</span> term and differentiating would have form:</p>
<div class="math notranslate nohighlight">
\[\frac{d}{dt} C_L^x = b_1 \ddot{h} + b_2 \ddot{\alpha} + a_3 \dot{\alpha}\]</div>
<p>where the <span class="math notranslate nohighlight">\(a_i\)</span> and <span class="math notranslate nohighlight">\(b_i\)</span> terms are the constant terms depending on <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(C_1\)</span>, <span class="math notranslate nohighlight">\(C_2\)</span> and the (constant) <span class="math notranslate nohighlight">\(C(k)\)</span> value, named the same way as their corresponding terms in the identified model. It is immediately visible that the identified model has strictly more terms than the simplified one, meaning that it should able to model more complex dynamics. That being said, the model identified using <span class="math notranslate nohighlight">\(x\)</span> shows a noticeably smaller error, highliting the usefullness of additional states related to the unsteady flow.</p>
</section>
</section>
<section id="conclusions">
<h2>Conclusions<a class="headerlink" href="#conclusions" title="Permalink to this headline">#</a></h2>
<p>It has been shown that adding <span class="math notranslate nohighlight">\(C_L^x = C_L - Du\)</span> to the state vector of the training data is a viable strategy for identification of the unsteady lift dynamical system. It was also discovered that using only <span class="math notranslate nohighlight">\(x' = [\dot{h}, \alpha, \dot{\alpha}, C_L^x]\)</span> as states can still yield a model of acceptable performance, and that it seems that the attenuation effects of the Theodorsen function on the lift can be at least partially modeled by a linear system with only <span class="math notranslate nohighlight">\(x'\)</span> as states. The latter fact, combined with more in-depth analysis, can help with the choice of states for the low Reynolds number unsteady lift models seeked in the future.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "rp_env"
        },
        kernelOptions: {
            kernelName: "rp_env",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'rp_env'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="08WagnerSINDy.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Identification of a dynamical system for the Wagner function</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="09Summary.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Summary</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Enrico Foglia, Maciej Michałów<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>